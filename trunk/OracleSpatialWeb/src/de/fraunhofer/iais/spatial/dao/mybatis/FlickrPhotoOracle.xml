<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="de.fraunhofer.iais.spatial.dao.mybatis.FlickrAreaDaoMybatisOracle">

	<select id="totalNum" resultType="long" useCache="false">
		select NUM_ROWS
		from user_tables
		where TABLE_NAME = 'FLICKR_EUROPE'
	</select>

	<select id="totalWorldPhotoNum" resultType="long" useCache="false">
		select NUM_ROWS
		from user_tables
		where TABLE_NAME = 'FLICKR_PHOTO'
	</select>

	<select id="totalPeopleNum" resultType="long" useCache="false">
		select NUM_ROWS
		from user_tables
		where TABLE_NAME = 'FLICKR_PEOPLE'
	</select>

	<select id="selectByDateQuery" resultType="FlickrPhoto" parameterType="map" useCache="false">
		<![CDATA[
		select
			PHOTO_ID as "id",
			TAKEN_DATE as "date",
			LATITUDE,
			LONGITUDE,
			USER_ID as "personId",
			SMALLURL,
			TITLE,
			VIEWED
 		from (
 			select p.* from
 					FLICKR_EUROPE p
			where p.REGION_${radius}_ID = #{areaid}
			 		and p.TAKEN_DATE >= to_date(#{queryStr}, #{oracleDatePatternStr})
			 		and p.TAKEN_DATE <  to_date(#{queryStr}, #{oracleDatePatternStr}) + interval '1' ${queryLevel}
			 order by p.TAKEN_DATE desc
			 )
		where rownum <= #{num}
		]]>
	</select>

	<!-- Test Query:
		select
				TAKEN_DATE as "date",
				LATITUDE,
				LONGITUDE,
				USER_ID as "personId",
				SMALLURL,
				TITLE,
				VIEWED
	      from (
	        select p.* from
	            FLICKR_EUROPE p
	        where p.REGION_5000_ID = 512
	            and p.TAKEN_DATE >= to_date('2008-11-12', 'yyyy-mm-dd')
	            and p.TAKEN_DATE <  to_date('2008-11-12', 'yyyy-mm-dd') + interval '1' month
	        order by p.TAKEN_DATE desc
	      )
		where rownum <= 30
	 -->

</mapper>